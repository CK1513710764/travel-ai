# 产品需求文档 (Product Requirements Document)

## 文档信息

| 项目名称 | AI 旅行规划师 (AI Travel Planner) |
|---------|----------------------------------|
| 文档版本 | v1.0 |
| 创建日期 | 2025-11-04 |
| 最后更新 | 2025-11-04 |
| 项目类型 | Web 应用 |
| 项目阶段 | 需求分析 & 设计阶段 |

---

## 1. 项目概述

### 1.1 项目背景
随着人工智能技术的发展和人们对个性化旅行体验需求的增长，传统的旅行规划方式已经无法满足现代用户的需求。用户需要一个智能化、便捷的工具来帮助他们快速生成个性化的旅行方案。

### 1.2 产品愿景
打造一款基于大语言模型的智能旅行规划助手，通过多模态交互（语音 + 文本），为用户提供个性化、可视化、智能化的旅行规划服务，让旅行规划变得简单、高效、有趣。

### 1.3 产品定位
- **目标用户**: 18-45岁热爱旅行的年轻用户群体
- **核心价值**: 智能化旅行规划 + 多模态交互 + 地图可视化 + 预算管理
- **差异化优势**: AI 驱动的个性化推荐、语音交互、实时地图可视化

---

## 2. 目标用户与用户画像

### 2.1 目标用户群体

#### 主要用户 (Primary Users)
1. **年轻白领** (25-35岁)
   - 工作繁忙，希望快速规划旅行
   - 注重旅行体验和性价比
   - 熟悉智能设备和新技术

2. **学生群体** (18-25岁)
   - 预算有限，需要精确的费用管理
   - 喜欢探索新鲜事物
   - 更倾向于使用移动端

3. **旅行爱好者** (30-45岁)
   - 经常旅行，需要高效的规划工具
   - 对旅行品质有较高要求
   - 希望能保存和管理多个旅行计划

### 2.2 用户画像 (User Persona)

**人物 A: 李明 (年轻白领)**
- **年龄**: 28岁
- **职业**: 互联网产品经理
- **收入**: 月薪 15k
- **痛点**: 工作繁忙，没有时间详细规划旅行路线
- **需求**:
  - 快速生成旅行方案（5分钟内）
  - 语音输入更便捷
  - 能看到详细的预算分析
  - 地图上直观展示行程路线

**人物 B: 张小雨 (大学生)**
- **年龄**: 21岁
- **职业**: 大三学生
- **收入**: 每月生活费 2k
- **痛点**: 预算有限，担心超支；不知道如何规划合理路线
- **需求**:
  - 精确的预算预估和费用追踪
  - 性价比高的景点和餐厅推荐
  - 能记录实际开销，对比预算

**人物 C: 王芳 (旅行达人)**
- **年龄**: 35岁
- **职业**: 自由职业者
- **收入**: 月收入 20k
- **痛点**: 经常旅行，需要管理多个旅行计划
- **需求**:
  - 保存多个旅行方案
  - 多设备同步查看
  - 分享旅行计划给朋友

---

## 3. 核心功能需求

### 3.1 功能清单与优先级

| 功能模块 | 功能描述 | 优先级 | 实现难度 |
|---------|---------|--------|----------|
| 用户认证系统 | 注册、登录、登出 | P0 (必须有) | 低 |
| 智能行程生成 | AI 生成个性化旅行路线 | P0 (必须有) | 高 |
| 多模态输入 | 语音 + 文本输入 | P0 (必须有) | 中 |
| 地图可视化 | 地图标记点和路线展示 | P0 (必须有) | 中 |
| 预算分析 | AI 预估费用 | P0 (必须有) | 中 |
| 费用追踪 | 记录实际开销 | P1 (应该有) | 低 |
| 视觉呈现 | 景点图片展示 | P1 (应该有) | 低 |
| 行程管理 | 查看、编辑、删除行程 | P1 (应该有) | 低 |
| 数据云端同步 | 多设备数据同步 | P1 (应该有) | 低 |
| 行程分享 | 分享给好友 | P2 (可以有) | 中 |
| 协同编辑 | 多人协作规划 | P3 (未来考虑) | 高 |

### 3.2 详细功能描述

#### F1. 用户认证系统

**功能描述**:
提供用户注册、登录、登出功能，确保用户数据安全和持久化。

**需求细节**:
- 支持邮箱注册和登录
- 邮箱验证
- 密码强度要求（至少8位，包含字母和数字）
- JWT Token 认证机制
- 用户头像上传（可选）
- 找回密码功能

**验收标准**:
- [ ] 用户可以成功注册账号
- [ ] 用户可以通过邮箱和密码登录
- [ ] 登录后能正常访问受保护的页面
- [ ] 登出后需要重新登录才能访问受保护页面

---

#### F2. 智能行程生成

**功能描述**:
基于用户输入的旅行要求，通过 AI 大模型自动生成详细的每日旅行行程。

**输入参数**:
- **必填项**:
  - 目的地城市（支持国内主要城市）
  - 出发日期
  - 返回日期（自动计算旅行天数）
  - 预算范围（元）
  - 同行人数

- **可选项**:
  - 旅行风格（冒险型、文化型、休闲型、美食型）
  - 特殊需求（如：必去景点、饮食偏好）

**输出内容**:
每日行程包含：
- 上午、下午、晚上的活动安排
- 推荐景点（含景点介绍、开放时间、门票价格）
- 推荐餐厅（含菜系、人均消费）
- 交通方式建议（地铁、公交、打车）
- 住宿推荐（酒店类型、价格区间）
- 每日预估费用

**AI 生成要求**:
- 路线合理性：景点之间的距离和交通时间合理
- 时间安排：考虑景点开放时间、用餐时间、休息时间
- 预算匹配：总费用应在用户预算范围内
- 个性化：根据用户偏好调整推荐内容

**验收标准**:
- [ ] 用户提交完整信息后，30秒内生成完整行程
- [ ] 生成的行程包含每日详细安排
- [ ] 行程符合逻辑（路线合理、时间安排合理）
- [ ] 预算预估准确度在 ±20% 范围内

---

#### F3. 多模态输入

**功能描述**:
用户可以通过语音或文本两种方式输入旅行需求。

**语音输入**:
- 使用 Web Speech API 实现浏览器内语音识别
- 支持中文普通话识别
- 实时转换为文本显示在输入框
- 用户可以在识别后编辑文本内容

**文本输入**:
- 标准表单输入
- 字段验证（日期、预算格式等）
- 输入提示和自动补全

**用户流程**:
1. 点击"语音输入"按钮或直接填写表单
2. （语音模式）说话，系统实时转文字
3. 检查并编辑识别结果
4. 点击"生成行程"

**验收标准**:
- [ ] 语音识别准确率达到 80% 以上
- [ ] 用户可以随时切换语音和文本输入方式
- [ ] 语音识别结果可以被编辑
- [ ] 表单验证正常工作

---

#### F4. 地图可视化

**功能描述**:
在交互式地图上展示行程中的所有地点，并绘制每日的访问路线。

**地图功能**:
- **标记点 (Markers)**:
  - 不同类型的地点使用不同图标（景点、餐厅、酒店）
  - 点击标记显示详细信息（名称、地址、简介）
  - 标记点按天数分组，可以筛选显示

- **路线规划**:
  - 绘制每日的推荐访问路线
  - 显示路线距离和预计交通时间
  - 支持切换不同交通方式（驾车、公交、步行）

- **地图交互**:
  - 缩放、平移
  - 全景查看
  - 切换地图类型（标准、卫星）

**技术实现**:
- 使用高德地图 JS API
- 地点信息通过高德地图 POI 搜索获取
- 路线规划使用高德路径规划 API

**验收标准**:
- [ ] 所有行程地点正确显示在地图上
- [ ] 路线清晰可见，方向正确
- [ ] 地图交互流畅，无卡顿
- [ ] 点击标记能显示详细信息

---

#### F5. 预算分析与费用追踪

**功能描述**:
AI 自动分析旅行预算，用户可以记录实际开销并对比预算。

**预算分析（AI 生成）**:
- 按类别预估费用：
  - 交通费（往返大交通 + 市内交通）
  - 住宿费（每晚价格 × 天数）
  - 餐饮费（早中晚三餐）
  - 门票费（所有景点门票总和）
  - 其他费用（购物、娱乐等）
- 总费用与用户预算对比
- 费用优化建议

**费用追踪**:
- 用户手动添加开销记录：
  - 日期
  - 类别（交通/住宿/餐饮/门票/其他）
  - 金额
  - 备注
- 实时计算已花费金额
- 显示预算剩余
- 可视化图表展示（饼图、柱状图）

**数据统计**:
- 按类别统计实际支出
- 预算 vs 实际对比
- 超支预警

**验收标准**:
- [ ] AI 预估的总预算在合理范围内
- [ ] 用户可以方便地添加费用记录
- [ ] 实时更新预算剩余金额
- [ ] 图表清晰展示费用分布

---

#### F6. 行程管理

**功能描述**:
用户可以查看、编辑、删除自己创建的所有旅行计划。

**功能点**:
- **行程列表**:
  - 显示所有旅行计划卡片
  - 卡片信息：目的地、日期、天数、预算
  - 按创建时间或出发日期排序

- **行程详情**:
  - 完整的每日行程安排
  - 地图可视化
  - 预算分析
  - 费用记录

- **编辑行程**:
  - 修改基本信息（日期、预算等）
  - 重新生成行程

- **删除行程**:
  - 二次确认弹窗
  - 删除后不可恢复

**验收标准**:
- [ ] 用户可以看到所有自己的行程
- [ ] 可以正常编辑和删除行程
- [ ] 数据实时同步到云端

---

#### F7. 数据云端同步

**功能描述**:
所有用户数据（行程、偏好、费用记录）保存在云端，支持多设备访问。

**同步内容**:
- 用户账户信息
- 所有旅行计划
- 用户偏好设置
- 费用记录

**技术实现**:
- 使用 Supabase 作为后端服务
- 数据实时同步
- 离线缓存（本地 IndexedDB）

**验收标准**:
- [ ] 用户在不同设备登录看到相同数据
- [ ] 数据修改后自动同步
- [ ] 网络断开时有友好提示

---

#### F8. 视觉呈现

**功能描述**:
在行程展示中加入景点和城市的精美图片，提升用户体验。

**图片来源**:
- AI 生成景点推荐时，通过图片 API 获取相关图片
- 优先使用高质量旅游图片
- 每个景点至少1张图片

**展示位置**:
- 行程卡片封面图
- 景点详情页大图
- 每日行程的景点配图

**技术实现**:
- 使用图片 API（如 Unsplash API）
- 图片懒加载优化性能
- 图片缓存减少请求

**验收标准**:
- [ ] 每个景点都有配图
- [ ] 图片加载速度快（< 2秒）
- [ ] 图片质量高，符合旅游主题

---

## 4. 用户故事 (User Stories)

### 核心用户故事

**US-01: 快速创建旅行计划**
```
作为一个 忙碌的白领用户
我想要 通过语音快速输入旅行需求
以便 在短时间内获得完整的旅行方案
```
**验收标准**:
- 语音输入流畅，识别准确
- 5分钟内完成输入和行程生成
- 生成的行程详细且合理

---

**US-02: 直观查看行程路线**
```
作为一个 使用旅行规划的用户
我想要 在地图上看到所有地点和路线
以便 直观理解每天的行程安排
```
**验收标准**:
- 所有地点清晰标注在地图上
- 路线连贯，方向正确
- 可以筛选查看某一天的路线

---

**US-03: 控制旅行预算**
```
作为一个 预算有限的学生用户
我想要 看到详细的费用预估和追踪实际花费
以便 确保不会超出预算
```
**验收标准**:
- 预算预估详细到每个类别
- 可以方便地记录每笔开销
- 实时显示预算剩余

---

**US-04: 多设备访问**
```
作为一个 经常出差的旅行达人
我想要 在手机和电脑上都能访问我的旅行计划
以便 随时随地查看和管理行程
```
**验收标准**:
- 数据自动同步到云端
- 在不同设备上看到一致的数据
- 响应式设计适配手机和电脑

---

## 5. 非功能性需求 (Non-Functional Requirements)

### 5.1 性能要求

| 指标 | 要求 | 测量方式 |
|------|------|---------|
| 页面加载时间 | < 3秒 | Lighthouse 测试 |
| AI 行程生成时间 | < 30秒 | 后端日志记录 |
| 地图渲染时间 | < 2秒 | 浏览器 Performance API |
| 并发用户数 | 支持 1000+ | 压力测试 |
| API 响应时间 | < 500ms | 后端监控 |

### 5.2 安全要求

- **身份认证**: JWT Token + 邮箱验证
- **数据加密**: HTTPS 传输，密码 bcrypt 加密
- **权限控制**: Row Level Security (RLS) 确保用户只能访问自己的数据
- **API 安全**:
  - 所有 API Key 使用环境变量管理
  - 严禁在代码中硬编码密钥
  - 实现 API 请求频率限制（Rate Limiting）
- **数据备份**: Supabase 自动备份

### 5.3 可用性要求

- **系统可用性**: 99% 以上（课程项目期间）
- **浏览器兼容性**:
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+
- **响应式设计**: 支持桌面端和移动端
- **多语言支持**: 当前仅支持中文（未来可扩展英文）

### 5.4 可维护性要求

- **代码规范**:
  - 使用 ESLint + Prettier
  - TypeScript 类型检查
  - 统一的命名规范
- **文档完整性**:
  - README 包含启动说明
  - API 接口文档
  - 代码注释
- **测试覆盖**:
  - 关键功能单元测试（目标 60%+）
  - API 集成测试
- **日志记录**:
  - 错误日志
  - 用户操作日志
  - API 调用日志

### 5.5 扩展性要求

- **模块化设计**: 前后端分离，组件化开发
- **数据库设计**: 规范化设计，易于扩展新表
- **API 设计**: RESTful 风格，版本控制
- **容器化部署**: Docker + Docker Compose，易于迁移

---

## 6. 技术栈详细说明

### 6.1 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 18+ | UI 框架 |
| Vite | 5+ | 构建工具 |
| TypeScript | 5+ | 类型系统 |
| React Router | 6+ | 路由管理 |
| Zustand / Redux Toolkit | Latest | 状态管理 |
| Ant Design / Material-UI | Latest | UI 组件库 |
| Amap JS API | Latest | 地图可视化 |
| Recharts / Chart.js | Latest | 数据可视化 |
| Axios | Latest | HTTP 客户端 |
| Web Speech API | Native | 语音识别 |

### 6.2 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | 18+ LTS | 运行环境 |
| Express | 4+ | Web 框架 |
| TypeScript | 5+ | 类型系统 |
| Supabase Client | Latest | 数据库客户端 |
| 阿里云百炼 SDK | Latest | LLM API 调用 |
| 高德地图 API | Latest | 地图数据 |
| dotenv | Latest | 环境变量管理 |
| Winston | Latest | 日志记录 |

### 6.3 数据库与认证

| 技术 | 用途 |
|------|------|
| Supabase (PostgreSQL) | 关系型数据库 |
| Supabase Auth | 用户认证 |
| Supabase Storage | 文件存储（用户头像） |
| Row Level Security | 数据隔离 |

### 6.4 开发与部署工具

| 工具 | 用途 |
|------|------|
| Docker | 容器化 |
| Docker Compose | 多容器编排 |
| Git | 版本控制 |
| ESLint + Prettier | 代码规范 |
| Jest / Vitest | 单元测试 |

---

## 7. 系统架构

### 7.1 整体架构图

```
┌─────────────────────────────────────────────────────────┐
│                     用户设备                              │
│  ┌──────────────┐         ┌──────────────┐              │
│  │  Web 浏览器   │         │   移动浏览器   │              │
│  └──────┬───────┘         └──────┬───────┘              │
└─────────┼────────────────────────┼────────────────────────┘
          │                        │
          │       HTTPS            │
          │                        │
┌─────────▼────────────────────────▼────────────────────────┐
│              前端 (React + Vite)                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐               │
│  │ 页面组件  │  │  状态管理 │  │ 路由管理  │               │
│  └──────────┘  └──────────┘  └──────────┘               │
│  ┌──────────────────────────────────────┐                │
│  │        API Client (Axios)            │                │
│  └─────────────────┬────────────────────┘                │
└────────────────────┼───────────────────────────────────────┘
                     │
                     │  REST API
                     │
┌────────────────────▼───────────────────────────────────────┐
│              后端 (Node.js + Express)                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                │
│  │ 路由层    │  │ 控制器层  │  │ 服务层    │                │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘                │
│       │             │             │                       │
│       └─────────────┴─────────────┘                       │
│                     │                                     │
│  ┌──────────────────┴────────────────────┐               │
│  │         中间件层                       │               │
│  │  Auth │ Validation │ Error Handler     │               │
│  └──────────────────┬────────────────────┘               │
└─────────────────────┼──────────────────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
        ▼             ▼             ▼
┌──────────┐   ┌──────────┐   ┌──────────┐
│ Supabase │   │ 阿里云百炼│   │ 高德地图  │
│ (DB+Auth)│   │ (LLM)    │   │  (Map)   │
└──────────┘   └──────────┘   └──────────┘
```

### 7.2 数据流示意图

**用户创建旅行计划的数据流**:

```
用户输入(语音/文本)
  → 前端表单验证
  → POST /api/trips
  → 后端身份验证
  → 调用阿里云百炼 API
  → 解析 LLM 响应
  → 调用高德地图 API 获取位置信息
  → 存储到 Supabase
  → 返回完整行程 JSON
  → 前端渲染行程和地图
```

---

## 8. 项目里程碑与时间规划

### 8.1 开发阶段划分

| 阶段 | 任务 | 预计时间 | 交付物 |
|------|------|---------|--------|
| Phase 0 | 需求分析与设计 | 1周 | PRD、原型设计、技术设计文档 |
| Phase 1 | 项目初始化与基础架构搭建 | 3天 | Docker 环境、前后端骨架、Supabase 配置 |
| Phase 2 | 用户认证系统 | 3天 | 注册、登录、JWT 认证 |
| Phase 3 | AI 行程生成核心功能 | 5天 | LLM 集成、行程生成逻辑 |
| Phase 4 | 地图可视化 | 4天 | 高德地图集成、标记点、路线绘制 |
| Phase 5 | 预算分析与费用追踪 | 3天 | 预算计算、费用记录、数据可视化 |
| Phase 6 | 语音输入功能 | 2天 | Web Speech API 集成 |
| Phase 7 | 行程管理与数据同步 | 3天 | CRUD 操作、云端同步 |
| Phase 8 | UI/UX 优化与视觉呈现 | 3天 | 美化界面、添加图片、响应式设计 |
| Phase 9 | 测试与 Bug 修复 | 4天 | 功能测试、性能测试、修复问题 |
| Phase 10 | 部署与文档完善 | 2天 | Docker 部署、README、演示准备 |

**总计**: 约 5-6 周

### 8.2 关键里程碑

- **M1 (Week 1)**: 完成需求分析和技术设计 ✓
- **M2 (Week 2)**: 基础架构搭建完成，用户可以注册登录
- **M3 (Week 3)**: AI 行程生成功能可用
- **M4 (Week 4)**: 地图可视化完成，可以看到完整路线
- **M5 (Week 5)**: 所有核心功能完成，开始测试
- **M6 (Week 6)**: 项目部署上线，文档完善

---

## 9. 风险与挑战

### 9.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 阿里云百炼 API 限流 | 高 | 中 | 实现请求缓存；准备备用 LLM API |
| 语音识别准确率低 | 中 | 高 | 提供文本输入备选方案；优化识别提示 |
| 地图 API 调用超限 | 中 | 低 | 实现地点数据缓存；监控 API 用量 |
| 数据库性能问题 | 高 | 低 | 优化查询；添加索引；使用 Supabase 的性能分析工具 |
| Docker 部署兼容性 | 中 | 中 | 在多个环境测试；提供详细文档 |

### 9.2 产品风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| AI 生成行程不合理 | 高 | 中 | 提供编辑功能；优化 Prompt；人工审核测试 |
| 用户体验不佳 | 中 | 中 | 进行用户测试；收集反馈；持续优化 UI |
| 功能范围蔓延 | 中 | 高 | 严格按照优先级开发；控制非核心功能 |

### 9.3 时间风险

| 风险 | 应对措施 |
|------|---------|
| 开发进度延期 | 每周 Review 进度；及时调整计划；优先保证 P0 功能 |
| 第三方服务不稳定 | 尽早集成测试；准备降级方案 |
| Bug 修复时间超预期 | 预留充足测试时间；使用问题跟踪工具 |

---

## 10. 成功指标 (Success Metrics)

### 10.1 功能完成度指标

- [ ] 100% P0 功能完成
- [ ] 80% P1 功能完成
- [ ] 核心用户流程无阻塞性 Bug

### 10.2 质量指标

- [ ] 前端 Lighthouse 性能评分 > 80
- [ ] API 平均响应时间 < 500ms
- [ ] 关键功能测试覆盖率 > 60%
- [ ] 零安全漏洞

### 10.3 用户体验指标

- [ ] AI 生成的行程逻辑合理性 > 90%（测试样本评估）
- [ ] 语音识别准确率 > 80%
- [ ] 用户能在 5 分钟内完成一次完整的行程创建流程

### 10.4 技术指标

- [ ] Docker 一键启动成功率 100%
- [ ] 所有 API Key 通过环境变量管理（代码中无硬编码）
- [ ] 前后端代码通过 Lint 检查（0 Error）

---

## 11. 后续迭代计划 (Future Roadmap)

### V2.0 计划功能（课程结束后）

- **社交功能**:
  - 行程分享给好友
  - 查看他人公开的旅行计划
  - 评论和点赞

- **协同编辑**:
  - 多人共同规划一次旅行
  - 实时协作编辑

- **智能推荐**:
  - 基于历史偏好推荐目的地
  - 相似用户的行程推荐

- **行程优化**:
  - AI 优化路线，减少往返时间
  - 根据实时交通调整路线

- **更多地图功能**:
  - 离线地图
  - AR 导航

- **多语言支持**:
  - 英文界面
  - 支持出境游规划

---

## 12. 附录

### 12.1 名词解释

- **LLM (Large Language Model)**: 大语言模型，如阿里云百炼
- **POI (Point of Interest)**: 兴趣点，指地图上的景点、餐厅等地点
- **RLS (Row Level Security)**: 行级安全策略，数据库级别的数据隔离机制
- **JWT (JSON Web Token)**: 用于身份认证的令牌格式

### 12.2 参考资料

- [阿里云百炼文档](https://help.aliyun.com/zh/model-studio/)
- [高德地图 JS API 文档](https://lbs.amap.com/api/javascript-api-v2/summary)
- [Supabase 文档](https://supabase.com/docs)
- [Web Speech API MDN 文档](https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API)

---

## 文档变更记录

| 版本 | 日期 | 修改人 | 变更说明 |
|------|------|--------|---------|
| v1.0 | 2025-11-04 | Claude | 初始版本，完整 PRD 文档 |

